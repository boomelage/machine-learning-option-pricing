<p>Machine Learning Option Pricing:An empirical approach based on S&amp;P500 dataBriciu, Radu-Stefan230031440Prof. Aleš ČernýSeptember 25, 20241Contents1Introduction32Model Specification42.1Pricing model . . . . . . . . . . . . . . . . . . . . . . . . . . . . .43Calibration Approach43.1Approximation of implied volatilites. . . . . . . . . . . . . . . .43.2Interpolation of volatility surface . . . . . . . . . . . . . . . . . .53.3Calibration data generation . . . . . . . . . . . . . . . . . . . . .64Training Procedure74.1Data generation . . . . . . . . . . . . . . . . . . . . . . . . . . . .74.2Machine learning model specification . . . . . . . . . . . . . . . .84.3Performance criteria . . . . . . . . . . . . . . . . . . . . . . . . .94.3.1Heston Model Calibration . . . . . . . . . . . . . . . . . .94.3.2Machine learning . . . . . . . . . . . . . . . . . . . . . . .95Results95.1Notes on the pricing model. . . . . . . . . . . . . . . . . . . . .96Proposal for future research107Conclusions117.1Notes on calibration. . . . . . . . . . . . . . . . . . . . . . . . .117.2Preliminary testing . . . . . . . . . . . . . . . . . . . . . . . . . .118References1221IntroductionThe main scope of this paper is to devise a data generation method which canbe reliably used to train machine learning algorithms in pricing options understochastic volatility models. It has been demonstrated by (Frey et al., 2022)that Single Layer and Deep Neural networks are able to accurately predictoption prices given a large synthetic training dataset.The data generationmethod outlined below is an extension of Frey et al. (2022) with additionalconsiderations regarding the feasibility of all feature combinations. The machinelearning model specification is nearly identical to that of Frey et al. (2022) witha few minor exceptions including the use of relative absolute pricing error as aperformance metric as well as exploration of additional activation functions andsolvers. Upon initial empirical testing, it was found that model performancecan be augmented if both calls and puts are considered with dummy variablesconsisting of one-hot-encoding of the flag ’call’ or ’put’.Following this result, it was considered whether the suite of SkLearn NeuralNetwork models could be used to price exotic options such as barrier and asianoptions. The practical reason being that such options require stochastic volatil-ity models in order to capture the correlation between the underlying’s returnand its volatility throughout the life of the option given the path-dependentpayoffs. Exotic options may not have any closed form solution and are thereforecomputationally intensive to obtain, especially given a portfolio of derivativecontracts.We therefore aim to generalize a data generation routine in which a set ofHeston model parameters is calibrated and subsequently used to price a numberof options given only the historical spot price and generic at the money volatili-ties for a time-series of historical option data. In order to achieve this scope, wewill have to implement a number of approximations, bringing with them variousassumptions and limitations.Figure 1: Example estimation of implied volatility gradient for 30 maturity onSPX call options32Model Specification2.1Pricing modelTo model the logarithmic price of our underlying security, we will be usingthe Heston (1993) model which is defined by the following pair of stochasticdifferential equations:dXt =r −vt2dt + √vtρdWt +p1 −ρ2dBt,dvt = α(β −vt)dt + η√vtdWt,where:• Xt is the logarithm of the asset price at time t,• vt is the instantaneous variance at time t,• r is the risk-free rate,• ρ is the correlation between the asset price and variance,• dWt and dBt are Wiener processes.3Calibration Approach3.1Approximation of implied volatilites• Derman approximation of volatility term structureσ(K, t0) = σatm(S0, t0) −b(t0)(K −S0),In order to approximate the shape of the underlying asset’s volatility surface,the above specification is used. It is assumed that an option’s implied volatilityis equal to the at-the-money volatility for that maturity plus the slope coefficientfor said maturity times the option’s moneyness expressed always as strike priceminus spot price.for t in derman<em>vols.index:term</em>struct = raw<em>ts.loc[:,t].dropna()K</em>reg = term<em>struct.indexx = np.array(K</em>reg- s, dtype=float)y = np.array(term<em>struct - derman</em>vols.loc[t],dtype=floatT)model = LinearRegression(fit<em>intercept=False)x = x.reshape(-1,1)model.fit(x,y)b = model.coef</em>[0]4Figure 2: Derman approximation of volatility surface3.2Interpolation of volatility surfaceql<em>vols = ql.Matrix(len(calibration</em>K),len(T),0.00)ql<em>T = ql.Array(T.tolist())ql</em>K = ql.Array(calibration<em>K.tolist())for i, k in enumerate(ql</em>K):for j, t in enumerate(ql<em>T):ql</em>vols[i][j] = derman<em>ts.loc[k,t]bicubic</em>vol = ql.BicubicSpline(ql<em>T, ql</em>K, ql<em>vols)The final functional form of our volatility surface is the bicubic spline inter-polation of the surface we generate by applying the linear coefficients obtainedearlier to the at-the-money volatilities for a vector of strikes. The resulting ma-trix is formatted as a QuantLib C++ python proxy object which then returnsthe volatility as a functional form of strike and maturity.5Figure 3: Bicubic spline interpolation of estimated volatility surface3.3Calibration data generationIn all data generating procedures, we use as a starting point the cartesian prod-uct of the desires strike prices and maturities. A single element vector with thespot price is added as this routine must only be performed per single spot pricein order to avoid unrealistic combinations of contract details. We then mapappropriate parameters via approximation or simple boolean masks.def generate</em>features(K,T,s):features = pd.DataFrame(product([float(s)],K,T,),columns=["spot<em>price","strike</em>price","days<em>to</em>maturity",])return features6Figure 4: Alternative angle showing volatility skew4Training Procedure4.1Data generationIn order to maintain suitability in the combinations of parameters used in modeltraining, we employ the following technique of generating contract features.n= 100n<em>strikes = int(n*10)n</em>maturities = int(n)T = np.linspace(1,7,n<em>maturities).astype(int)n</em>contracts = int(n<em>maturities*n</em>strikes<em>2)print(f"\n\npricing {n_contracts} contracts...")pricing_spread = 0.002call_K_interp = np.linspace(s</em>(1+pricing<em>spread), s*(1+3*pricing</em>spread),int(n<em>strikes))put</em>K<em>interp = np.linspace(s*(1-3*pricing</em>spread),s*(1-pricing<em>spread),int(n</em>strikes))7Similar to the calibration data generation approach, we set the strike pricesin increments from but excluding the spot price for a predetermined modelchoice spread.call<em>features = generate</em>train<em>features(call</em>K<em>interp , T,s, ['call'])call</em>features['moneyness'] = call<em>features['spot</em>price']/call<em>features['strike</em>price']put<em>features = generate</em>train<em>features(put</em>K<em>interp , T, s, ['put'])put</em>features['moneyness'] = put<em>features['strike</em>price']/put<em>features['spot</em>price']features = call<em>featuresfeatures = pd.concat([call</em>features ,put<em>features],ignore</em>index=True).reset<em>index(drop=True)train</em>K = np.sort(np.array([put<em>K</em>interp ,call<em>K</em>interp],dtype=int).flatten())features = features.apply(bicubic<em>vol</em>row ,axis=1,bicubic<em>vol = bicubic</em>vol)features['dividend<em>rate'] = 0.02features['risk</em>free<em>rate'] = 0.04We generate the calls and puts separately in order to price only out of themoney options. This is a temporary measure taken due to limitations of themodel to be discussed in the following section. For historical testing, a generaldividend rate and risk free rate can be obtained4.2Machine learning model specificationtransformers:[('StandardScaler', StandardScaler(), ['spot</em>price', 'strike<em>price', 'days</em>to<em>maturity']), ('encode',OneHotEncoder(), ['w'])]activation: tanhsolver: sgdlearning rate: adaptivehidden layers: (100, 100, 100)features:['spot</em>price', 'strike<em>price', 'days</em>to_maturity', 'w']84.3Performance criteria4.3.1Heston Model CalibrationDuring model calibration, the error function being minimized is that of therelative error between the Heston model price and the Black Scholes price for agiven implied volatility.4.3.2Machine learningWhen testing the out-of-sample performance of the predicted prices, the abso-lute relative error is used as a measure.5Results5.1Notes on the pricing modelThe specification of our pricing model presents certain limitations which hinderthe flexibility of its pricing capacities. The first major assumption we make isthat of linearity in the term structure of volatilities. Namely, Derman’s methodfor approximating the gradient for volatilities against moneyness assumes a lin-ear relationship between the two variables. While this is largely true, the coef-ficients are often disturbed by the presence of volatility smiles, most commonlyfound in shorter maturities. Without applying any further method, the presenceof a volatility simile means that we cannot accurately obtain a linear gradientcoefficient for that maturity. Lastly, it is also assumed that the coefficient valuesper maturity themselves are constant over time which is not strictly the case.Figure 5: Deep Neural Network estimation for out-of-the-money puts and calls9Figure 6: Deep Neural Network estimation for small sample of out-of-the-moneycalls6Proposal for future researchDue to the tendency of machine learning algorithms to overfit on training dataand perform poorly out of sample, the proposition is that machine learning al-gorithms can be used as a means to quickly price more complex exotic optionswhich require considerably more computational effort. Such a model can betrained on an appropriate generated dataset to store the market conditions an-ticipated for the horizon of its use until retraining. A model such as the deepneural network once trained reliably with appropriate data can price exotic op-tions in negligible amounts of time compared to Monte Carlo simulation. Asmall batch of tests were ran on barrier options but data generation is a com-putationally intense endeavor as we are ideally training the model with at leastone million option prices for a reliable outcome. The results of one-hot-encodedcategorical features in performance indicate their potential for classifying thefour types of barrier options (i.e., out-in, down-in, out-up, down-up).107Conclusions7.1Notes on calibrationThe model currently calibrates parameters globally for one training day acrossmultiple strikes and maturities.The calibration accuracy can be improvedgreatly by obtaining a parameter set for each maturity and applying those ap-propriately in the data generation routine.7.2Preliminary testingPreliminary testing of the machine learning models have shown that there arebenefits to giving the model more information such as a variety of payoffs.Further to the work done by Frey et al. (2022) it was found that giving themodel data will fewer unrealistic combinations of pricing variables also leads toa reduction of prediction error.Furthermore, due to the construction of our pricing model, the pricing accu-racy decreases dramatically with maturity or deviation from moneyness. There-fore, when generating more diverse datasets (i.e., wider range of strikes and ma-turities) the model becomes unreliable as does the machine learning algorithm’sability to predict its pricing functional further indicating a tendency to overfiton training data.Final note: this paper is accompanied by the source code developed duringresearch as well as a simplified hard-coded example in a single Jupyter Note-book118ReferencesDerman, E. (2008). https://emanuelderman.com/wp-content/uploads/2013/09/smile-lecture9.pdf. [online] EmanuelDerman. Available at: https://emanuelderman.com/wp-content/uploads/2013/09/smile-lecture9.pdf [Accessed 23 Sep. 2024].Frey, C.,Scheuch, C., Voigt, S. and Weiss, P. (2022).Option Pricing via MachineLearning with Python. [online] Tidy Finance. Available at: https://www.tidy-finance.org/python/option-pricing-via-machine-learning.html [Accessed 23 Sep.2024].Khalife, D., Jad12</p>
